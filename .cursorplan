# DM Screen - Cursor Development Plan

## Source Directory
`/Users/xuan/dm-screen`

## Overview
Build a web-based, customizable Dungeon Master screen with drag-and-drop widgets, infinite scrolling canvas, adjustable grid system, and export/import functionality.

## Technology Stack
- **Framework**: React + TypeScript
- **Build Tool**: Vite
- **State Management**: Zustand
- **Drag & Drop**: @dnd-kit/core
- **Styling**: CSS Modules + CSS Variables
- **Markdown**: react-markdown

---

## Phase 1: Foundation & Setup

### 1.1 Project Initialization ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen`

- [x] Initialize Vite project with React + TypeScript template
- [x] Install core dependencies: zustand, @dnd-kit/core, react-markdown, marked
- [x] Install dev dependencies: @types packages, ESLint, Prettier
- [x] Configure TypeScript (tsconfig.json)
- [x] Set up ESLint and Prettier configs
- [x] Create folder structure (components, hooks, store, utils, types, styles)
- [x] Create GitHub Actions workflow for Pages deployment
- [x] Update vite.config.ts with base path for GitHub Pages

### 1.2 Type Definitions & Data Structures ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/types`

- [x] Create `src/types/index.ts` with all TypeScript interfaces:
  - [x] DMScreen interface
  - [x] Widget interface
  - [x] WidgetType union type
  - [x] WidgetStyle interface
  - [x] WidgetData types for each widget
  - [x] Theme interface
  - [x] Viewport interface

### 1.3 State Management Setup ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/store`

- [x] Create `src/store/screenStore.ts` with Zustand store:
  - [x] Screen state (gridSize, zoom, mode, viewport, canvasSize)
  - [x] Widgets array
  - [x] Theme settings
  - [x] Actions: setGridSize, setZoom, setMode, setViewport, addWidget, updateWidget, deleteWidget
  - [x] Persist to localStorage

### 1.4 Grid System Utilities ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/utils`

- [x] Create `src/utils/grid.ts`:
  - [x] Constants: DEFAULT_GRID_SIZE, MIN_GRID_SIZE, MAX_GRID_SIZE
  - [x] getGridUnitSize() function
  - [x] pixelsToGrid() function
  - [x] gridToPixels() function
  - [x] snapToGrid() function
  - [x] adjustWidgetPositionForGridChange() function
  - [x] calculateCanvasBounds() function

### 1.5 Theme System ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/styles`

- [x] Create `src/styles/theme.css`:
  - [x] CSS variables for dark mode colors
  - [x] Background colors (primary, secondary, panel variants)
  - [x] Text colors (primary, secondary)
  - [x] Accent colors (blue, green, yellow, red)
  - [x] Grid size variable
- [x] Create `src/styles/components.css` for base component styles

### 1.6 Main Layout Component ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/common`

- [x] Create `src/components/common/GridContainer.tsx`:
  - [x] Infinite scrolling canvas container
  - [x] Viewport state management
  - [x] Mouse drag panning (Alt+Click or middle mouse)
  - [x] Wheel scrolling support
  - [x] Grid overlay rendering
  - [x] Dynamic canvas sizing based on widgets
  - [x] Transform/translate for viewport positioning
  - [x] Top-left anchor constraint (only scroll down/right)

### 1.7 Grid Size Controls ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/common`

- [x] Create `src/components/common/GridSizeControls.tsx`:
  - [x] Slider input for grid size (10-100)
  - [x] +/- buttons for quick adjustment
  - [x] Display current grid size
  - [x] Handle grid size changes (preserve widget positions)

### 1.8 Mode Toggle ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/common`

- [x] Create `src/components/common/ModeToggle.tsx`:
  - [x] Toggle button between 'normal' and 'edit' modes
  - [x] Visual indicator of current mode
  - [x] Update store on mode change

### 1.9 Zoom Controls ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/common`

- [x] Create `src/components/common/ZoomControls.tsx`:
  - [x] Zoom in button
  - [x] Zoom out button
  - [x] Reset zoom button
  - [x] Display current zoom level
  - [x] Handle zoom limits (e.g., 0.5x to 2x)

### 1.10 Base Widget Component ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [x] Create `src/components/widgets/BaseWidget.tsx`:
  - [x] Widget container with positioning (grid-based, top-left anchor)
  - [x] Permanent thin header bar (half grid size)
  - [x] Three-dots menu (horizontal ⋯) for Edit/Clone/Delete
  - [x] Drag handle (entire header in Edit mode)
  - [x] Resize handle (bottom-right corner, Edit mode only)
  - [x] Style props (backgroundColor, textColor, border, etc.)
  - [x] z-index management
  - [x] Grid snapping for drag and resize

### 1.11 Drag & Drop Hook ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/hooks`

- [x] Create `src/hooks/useDragAndDrop.ts`:
  - [x] Handle drag start/end events (custom implementation)
  - [x] Convert pixel positions to grid coordinates
  - [x] Snap to grid (round to nearest grid unit)
  - [x] Update widget position in store
  - [x] Disable in Normal mode
  - [x] Top-left anchor constraint

### 1.12 Resize Hook ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/hooks`

- [x] Create `src/hooks/useResize.ts`:
  - [x] Handle mouse down on resize handle
  - [x] Track mouse movement
  - [x] Calculate new size in grid units
  - [x] Snap to grid (round to nearest grid unit)
  - [x] Enforce minimum size (2 grid units)
  - [x] Update widget size in store

### 1.13 Main App Component ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src`

- [x] Create `src/App.tsx`:
  - [x] Render GridContainer
  - [x] Render ModeToggle
  - [x] Render GridSizeControls
  - [x] Render ZoomControls
  - [x] Render WidgetToolbar
  - [x] Render widgets from store via WidgetFactory
  - [x] Apply theme styles

### 1.14 Entry Point ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src`

- [x] Update `src/main.tsx`:
  - [x] Import App component
  - [x] Import theme CSS
  - [x] Render App to DOM
  - [x] Set up error boundaries

---

## Phase 2: Widget Implementation

### 2.1 Text Widget ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [x] Create `src/components/widgets/TextWidget.tsx`:
  - [x] Markdown rendering with react-markdown
  - [x] Text wrapping within widget bounds
  - [x] Edit mode: markdown editor (textarea)
  - [x] Normal mode: read-only display
  - [x] Widget data type: { content: string }
  - [x] Default size: 10x8 grid units

### 2.2 Notepad Widget ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [x] Create `src/components/widgets/NotepadWidget.tsx`:
  - [x] Plain text textarea (editable in Normal mode)
  - [x] Auto-save to store on change
  - [x] Edit mode: disabled for editing
  - [x] Widget data type: { content: string }
  - [x] Default size: 10x8 grid units

### 2.3 Image Widget ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [x] Create `src/components/widgets/ImageWidget.tsx`:
  - [x] Edit mode: URL input field with preview
  - [x] Image loading and display
  - [x] Error handling for invalid URLs (placeholder)
  - [x] Widget data type: { url: string, scale?: number }
  - [x] Default size: 10x8 grid units

### 2.4 Countdown Widget ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [x] Create `src/components/widgets/CountdownWidget.tsx`:
  - [x] Number display
  - [x] +/- buttons for increment/decrement
  - [x] Number input (type to edit)
  - [x] Mouse wheel scroll support
  - [x] Title field display
  - [x] Edit mode: configure title, default value, min/max
  - [x] Widget data type: { title: string, value: number, min?: number, max?: number }
  - [x] Default size: 6x5 grid units

### 2.5 Fraction Widget ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [x] Create `src/components/widgets/FractionWidget.tsx`:
  - [x] Current/Max number display (e.g., "45/60")
  - [x] +/- buttons for current value
  - [x] Edit mode: configure title, max value
  - [x] Prevent current > max
  - [x] Mouse wheel scroll support
  - [x] Widget data type: { title: string, current: number, max: number }
  - [x] Default size: 6x5 grid units

### 2.6 Toggles Widget ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [x] Create `src/components/widgets/TogglesWidget.tsx`:
  - [x] Configurable number of toggle circles/boxes
  - [x] Click to toggle on/off
  - [x] Visual feedback for checked state
  - [x] Edit mode: set count, style (circles vs boxes)
  - [x] Responsive sizing (scales to fit container)
  - [x] Widget data type: { count: number, toggles: boolean[], style: 'circle' | 'box' }
  - [x] Default size: 8x6 grid units

### 2.7 To-Dos Widget ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [x] Create `src/components/widgets/TodosWidget.tsx`:
  - [x] List of todo items
  - [x] Checkbox for each item
  - [x] Strikethrough for completed items
  - [x] Edit mode: add/remove items, edit text
  - [x] Normal mode: toggle completion only
  - [x] Widget data type: { items: Array<{ id: string, text: string, completed: boolean }> }
  - [x] Default size: 10x8 grid units

### 2.8 Pages Widget ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [x] Create `src/components/widgets/PagesWidget.tsx`:
  - [x] Multiple markdown pages
  - [x] Page navigation (prev/next buttons)
  - [x] Page indicator (e.g., "Page 2 of 5")
  - [x] Edit mode: add/remove pages, edit content
  - [x] Normal mode: navigate pages only
  - [x] Widget data type: { pages: Array<{ id: string, content: string }>, currentPage: number }
  - [x] Default size: 10x8 grid units

### 2.9 Character Widget (Container) ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [x] Create `src/components/widgets/CharacterWidget.tsx`:
  - [x] Container with name and icon label
  - [x] Color picker for icon background
  - [x] Number badge option
  - [x] Nested widgets support (render widgets inside)
  - [x] Collapse/expand functionality
  - [x] Move as unit (all nested widgets move together)
  - [x] Edit mode: add/remove nested widgets
  - [x] Widget data type: { name: string, iconColor: string, iconNumber?: number, widgets: Widget[], collapsed: boolean }
  - [x] Default size: 12x10 grid units

### 2.10 Widget Factory
**Source**: `/Users/xuan/dm-screen/src/components/widgets`

- [ ] Create `src/components/widgets/WidgetFactory.tsx`:
  - [ ] Switch statement to render correct widget type
  - [ ] Default widget data generators for each type
  - [ ] Widget creation helper functions

---

## Phase 3: Edit Mode Features

### 3.1 Widget Toolbar
**Source**: `/Users/xuan/dm-screen/src/components/common`

- [ ] Create `src/components/common/WidgetToolbar.tsx`:
  - [ ] List of all widget types with icons/names
  - [ ] Click to add new widget
  - [ ] Position: sidebar or floating panel
  - [ ] Visual feedback on hover

### 3.2 Widget Creation ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/store`

- [x] Add createWidget action to store (via widgetFactory):
  - [x] Generate unique ID
  - [x] Set default position (near top-left)
  - [x] Set default size (optimized per widget type)
  - [x] Initialize widget data with defaults
  - [x] Add to widgets array

### 3.3 Widget Cloning ✅ COMPLETE
**Source**: `/Users/xuan/dm-screen/src/store`

- [x] Add cloneWidget action to store:
  - [x] Deep copy widget
  - [x] Generate new ID
  - [x] Offset position slightly (2 grid units)
  - [x] Handle nested widgets in Character widgets
  - [x] Add cloned widget to array

### 3.4 Style Editor
**Source**: `/Users/xuan/dm-screen/src/components/common`

- [ ] Create `src/components/common/StyleEditor.tsx`:
  - [ ] Color picker for background color
  - [ ] Color picker for text color
  - [ ] Color picker for border color
  - [ ] Slider for border width
  - [ ] Slider for border radius
  - [ ] Live preview
  - [ ] Apply button or auto-apply

---

## Phase 4: Export/Import System

### 4.1 Export Utilities
**Source**: `/Users/xuan/dm-screen/src/utils`

- [ ] Create `src/utils/export.ts`:
  - [ ] ExportData interface
  - [ ] exportScreen() function (with includeState parameter)
  - [ ] resetWidgetToDefaults() helper
  - [ ] JSON serialization
  - [ ] Version tracking

### 4.2 Import Utilities
**Source**: `/Users/xuan/dm-screen/src/utils`

- [ ] Create `src/utils/import.ts`:
  - [ ] importScreen() function (async, returns Promise)
  - [ ] validateImportData() function
  - [ ] convertToScreen() function
  - [ ] Version migration (if needed)
  - [ ] Error handling

### 4.3 Export/Import UI
**Source**: `/Users/xuan/dm-screen/src/components/common`

- [ ] Create `src/components/common/ExportImportPanel.tsx`:
  - [ ] Export button (Current State)
  - [ ] Export button (Clean State)
  - [ ] File download trigger
  - [ ] Filename with timestamp
  - [ ] Import file input
  - [ ] Import confirmation dialog
  - [ ] Error messages display

---

## Phase 5: Testing & Polish

### 5.1 Unit Tests
**Source**: `/Users/xuan/dm-screen/tests/unit`

- [ ] Test grid utilities (grid.ts)
- [ ] Test export/import functions
- [ ] Test widget data validation

### 5.2 Component Tests
**Source**: `/Users/xuan/dm-screen/tests/unit`

- [ ] Test each widget component
- [ ] Test BaseWidget
- [ ] Test GridContainer

### 5.3 Integration Tests
**Source**: `/Users/xuan/dm-screen/tests/integration`

- [ ] Test drag and drop flow
- [ ] Test resize flow
- [ ] Test grid size change flow

### 5.4 E2E Tests
**Source**: `/Users/xuan/dm-screen/tests/e2e`

- [ ] Test complete screen creation workflow
- [ ] Test export/import workflow
- [ ] Test widget interactions

---

## Notes

- All coordinates use top-left anchor (0,0 = top-left corner)
- Grid size changes preserve widget positions (they stay in same grid coordinates)
- Infinite canvas expands based on widget positions
- Viewport position tracked in pixels, widget positions in grid units
- Dark mode first, light mode can be added later

